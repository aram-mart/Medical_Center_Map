<!DOCTYPE html>
<html lang="hy">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Medical Centers Map</title>

  <!-- Google Fonts: Montserrat -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 0;
      height: 100%;
      box-sizing: border-box;
      overflow: hidden;
    }

    header {
      display: flex;
      align-items: center;
      padding: 10px;
      background-color: #f8f8f8;
      border-bottom: 1px solid #ddd;
      position: relative;
    }

    header img {
      height: 80px;
      margin-right: 200px;
    }

    h2 {
      margin: 20px;
      text-align: center;
      flex-grow: 1;
      font-size: 22px;
    }

    #main-container {
      display: flex;
      height: calc(100vh - 70px);
      position: relative;
    }

    #left-panel {
      width: 25%;
      padding: 10px;
      overflow-y: auto;
      border-right: 1px solid #ddd;
      height: 100%;
      background-color: #f9f9f9;
      transition: all 0.3s ease;
      z-index: 900;
    }

    #left-panel.collapsed {
      width: 0;
      padding: 0;
      overflow: hidden;
    }

    #right-panel {
      width: 75%;
      height: 100%;
      transition: all 0.3s ease;
      position: relative;
    }
    
    #right-panel.expanded {
      width: 100%;
    }

    #search-container {
      text-align: center;
      margin-bottom: 10px;
    }

    #search,
    #categori-filter,
    #city-filter {
      width: 80%;
      max-width: 500px;
      padding: 8px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    #categori-filter-container,
    #city-filter-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
    }

    #filter-row {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 10px;
      gap: 10px;
    }

    .filter-select {
      width: 180px;
      padding: 8px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    #clear-filters-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
    }

    #clear-filters-btn img {
      width: 28px;
      height: 28px;
    }

    #clear-filters-btn:hover img {
      filter: brightness(0.8);
    }

    /* Screen-reader-only labels */
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    #map {
      width: 95%;
      height: 90%;
      margin: 3% auto;
      display: block;
    }

    .leaflet-control-attribution {
      display: none;
    }

    .center-item {
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
      background: white;
      transition: background 0.2s, border-color 0.2s; /* Transition for smooth color change */
    }

    .center-item:hover {
      background-color: #f1f1f1; /* Light grey background on hover */
      border-color: #007bff; /* Change border color to indicate interactivity */
    }

    .center-item a {
      color: black;
      text-decoration: none;
    }

    .center-item a:hover {
      text-decoration: underline;
    }

    .view-website-btn {
      display: inline-block;
      padding: 6px 12px;
      background-color: #007bff;
      color: white;
      border-radius: 4px;
      text-align: center;
      font-size: 14px;
      text-decoration: none;
      margin-top: 5px;
    }

    .view-website-btn:hover {
      background-color: #0056b3;
    }

    #bottom-line {
      background-color: white;
      width: 100%;
      position: fixed;
      bottom: 0;
      left: 0;
      border-top: 1px solid #ddd;
    }

    .center-item b {
      display: block;
      margin-bottom: 5px;
    }

    .center-item p {
      margin: 5px 0;
    }

    .text-font_size {
      font-size: 14px;
    }

    .text-font_size_title {
      font-size: 16px;
    }

    /* New styles for the open button - MODIFIED */
    #open-button-container {
      position: absolute;
      left: 20px; /* Position on the left side of the map */
      top: 20px; /* Position at the top */
      z-index: 1000; /* Ensure it's above the map */
    }

    #open-list-btn {
      display: flex;
      align-items: center;
      gap: 5px;
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 8px 12px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      font-weight: 600;
    }

    #open-list-btn img {
      width: 20px;
      height: 20px;
    }

    #open-list-btn:hover {
      background-color: #f1f1f1;
    }
    
    /* Responsive styles - MODIFIED for left panel on mobile */
    @media (max-width: 768px) {
      header {
        flex-direction: column;
        align-items: center;
        padding-bottom: 0;
      }
      
      header img {
        margin-right: 0;
        margin-bottom: 5px;
      }
      
      h2 {
        font-size: 18px;
        margin: 5px 10px;
      }
      
      #main-container {
        flex-direction: row; /* Keep as row for side panel */
        height: calc(100vh - 140px);
      }
      
      #left-panel {
        position: absolute;
        top: 0;
        left: 0;
        width: 80%; /* Use percentage width for mobile */
        height: 100%; /* Full height */
        max-height: none;
        border-right: 1px solid #ddd;
        z-index: 999;
        transform: translateX(0);
        transition: transform 0.3s ease;
      }
      
      #left-panel.collapsed {
        width: 80%; /* Keep width the same */
        padding: 10px; /* Keep padding */
        transform: translateX(-100%); /* Move off-screen to the left */
        overflow: hidden;
      }
      
      #right-panel {
        width: 100%;
        height: 100%;
      }
      
      #map {
        width: 100%;
        height: 100%;
        margin: 0;
      }
      
      .text-font_size {
        font-size: 12px;
      }
      
      .text-font_size_title {
        font-size: 14px;
      }
      
      #open-button-container {
        position: fixed;
        top: 10px;
        left: 10px;
      }
      
      /* Add some padding to the centers list on mobile */
      #centers-list {
        padding-bottom: 50px;
      }
    }
  </style>
</head>
<body>
  <header>
    <img src="https://static.wixstatic.com/media/1d13cb_80c44ec80813494aa81b7fc3cd51c0f2~mv2.png/v1/fill/w_136,h_95,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/efes-logo.png" alt="EFES Logo">
    <h2>‘∑’ñ‘∑’ç ’°’∫’°’∞’∏’æ’°’£÷Ä’°’Ø’°’∂ ’®’∂’Ø’•÷Ä’∏÷Ç’©’µ’°’∂ ’∞’•’ø ’∞’°’¥’°’£’∏÷Ä’Æ’°’Ø÷Å’∏’≤ ’¢’™’∑’Ø’°’Ø’°’∂ ’∞’°’Ω’ø’°’ø’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä</h2>
  </header>

  <div id="main-container">
    <div id="left-panel" class="collapsed">
      <div id="search-container">
        <input type="text" id="search" placeholder="üîç ’ì’∂’ø÷Ä’•’¨ ‘≤/‘ø-’´ ’°’∂’∏÷Ç’∂’∏’æ" oninput="filterMarkers()" aria-label="’ì’∂’ø÷Ä’•’¨ ‘≤/‘ø-’´ ’°’∂’∏÷Ç’∂’∏’æ">
      
        <div id="filter-row">
          <label for="categori-filter" class="visually-hidden">‘ø’°’ø’•’£’∏÷Ä’´’°</label>
          <select id="categori-filter" class="filter-select" onchange="filterMarkers()">
            <option value="">‘∏’∂’ø÷Ä’•’¨ ’Ø’°’ø’•’£’∏÷Ä’´’°</option>
            <option value="‘±’∫’°’∞’∏’æ’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂">‘±’∫’°’∞’∏’æ’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂</option>
            <option value="‘±’≠’ø’∏÷Ä’∏’∑’´’π ’Ø’•’∂’ø÷Ä’∏’∂">‘±’≠’ø’∏÷Ä’∏’∑’´’π ’Ø’•’∂’ø÷Ä’∏’∂</option>
            <option value="‘±’¥’¢’∏÷Ç’¨’°’ø’∏÷Ä ’Ø’•’∂’ø÷Ä’∏’∂">‘±’¥’¢’∏÷Ç’¨’°’ø’∏÷Ä ’Ø’•’∂’ø÷Ä’∏’∂</option>
            <option value="‘±’ø’°’¥’∂’°’¢’∏÷Ç’™’°÷Ä’°’∂">‘±’ø’°’¥’∂’°’¢’∏÷Ç’™’°÷Ä’°’∂</option>
            <option value="‘≤’∏÷Ç’™‚Ä§ ‘ø’•’∂’ø÷Ä’∏’∂">‘≤’∏÷Ç’™‚Ä§ ‘ø’•’∂’ø÷Ä’∏’∂</option>
            <option value="‘¥’•’≤’°’ø’∏÷Ç’∂">‘¥’•’≤’°’ø’∏÷Ç’∂</option>
            <option value="‘º’°’¢’∏÷Ä’°’ø’∏÷Ä’´’°">‘º’°’¢’∏÷Ä’°’ø’∏÷Ä’´’°</option>
            <option value="’ä’∏’¨’´’Ø’¨’´’∂’´’Ø’°">’ä’∏’¨’´’Ø’¨’´’∂’´’Ø’°</option>
            <option value="’ï’∫’ø’´’Ø’°">’ï’∫’ø’´’Ø’°</option>
          </select>
    
          <label for="city-filter" class="visually-hidden">’î’°’≤’°÷Ñ</label>
          <select id="city-filter" class="filter-select" onchange="filterMarkers()">
            <option value="">‘∏’∂’ø÷Ä’•’¨ ÷Ñ’°’≤’°÷Ñ’®</option>
            <option value="‘µ÷Ä÷á’°’∂">‘µ÷Ä÷á’°’∂</option>
            <option value="‘≥’µ’∏÷Ç’¥÷Ä’´">‘≥’µ’∏÷Ç’¥÷Ä’´</option>
            <option value="’é’°’∂’°’±’∏÷Ä">’é’°’∂’°’±’∏÷Ä</option>
            <option value="‘∑’ª’¥’´’°’Æ’´’∂">‘∑’ª’¥’´’°’Æ’´’∂</option>
            <option value="‘±’¢’∏’æ’µ’°’∂">‘±’¢’∏’æ’µ’°’∂</option>
            <option value="‘ø’°’∫’°’∂">‘ø’°’∫’°’∂</option>
            <option value="’Ä÷Ä’°’¶’§’°’∂">’Ä÷Ä’°’¶’§’°’∂</option>
            <option value="‘±÷Ä’¥’°’æ’´÷Ä">‘±÷Ä’¥’°’æ’´÷Ä</option>
            <option value="’Ñ’°’Ω’´’Ω">’Ñ’°’Ω’´’Ω</option>
            <option value="‘±÷Ä’°÷Ä’°’ø">‘±÷Ä’°÷Ä’°’ø</option>
            <option value="’â’°÷Ä’•’∂÷Å’°’æ’°’∂">’â’°÷Ä’•’∂÷Å’°’æ’°’∂</option>
            <option value="‘ª’ª÷á’°’∂">‘ª’ª÷á’°’∂</option>
            <option value="‘±÷Ä’ø’°’∑’°’ø">‘±÷Ä’ø’°’∑’°’ø</option>
            <option value="‘≥’∏÷Ä’´’Ω">‘≥’∏÷Ä’´’Ω</option>
            <option value="’ç÷á’°’∂">’ç÷á’°’∂</option>
            <option value="‘≥’°’æ’°’º">‘≥’°’æ’°’º</option>
            <option value="‘±÷Ä’©’´’Ø">‘±÷Ä’©’´’Ø</option>
            <option value="‘±’∑’ø’°÷Ä’°’Ø">‘±’∑’ø’°÷Ä’°’Ø</option>
            <option value="‘¥’´’¨’´’ª’°’∂">‘¥’´’¨’´’ª’°’∂</option>
            <option value="’ç’´’Ω’´’°’∂">’ç’´’Ω’´’°’∂</option>
            <option value="’ç’∫’´’ø’°’Ø">’ç’∫’´’ø’°’Ø</option>
            <option value="‘µ’≤’æ’°÷Ä’§">‘µ’≤’æ’°÷Ä’§</option>
            <option value="’é’°÷Ä’§’•’∂’´’Ω">’é’°÷Ä’§’•’∂’´’Ω</option>
            <option value="‘±’¨’°’æ’•÷Ä’§’´">‘±’¨’°’æ’•÷Ä’§’´</option>
            <option value="’ç’ø’•÷É’°’∂’°’æ’°’∂">’ç’ø’•÷É’°’∂’°’æ’°’∂</option>
            <option value="’é’•’§’´">’é’•’§’´</option>
            <option value="’Ñ’°÷Ä’ø’∏÷Ç’∂’´">’Ñ’°÷Ä’ø’∏÷Ç’∂’´</option>
            <option value="‘≤’µ’∏÷Ç÷Ä’•’≤’°’æ’°’∂">‘≤’µ’∏÷Ç÷Ä’•’≤’°’æ’°’∂</option>
            <option value="’Ü’∏÷Ä ’Ä’°’≥’∂">’Ü’∏÷Ä ’Ä’°’≥’∂</option>
            <option value="’Ñ’•’Æ’°’¥’∏÷Ä">’Ñ’•’Æ’°’¥’∏÷Ä</option>
            <option value="’è’°’∑’´÷Ä">’è’°’∑’´÷Ä</option>
            <option value="‘µ’≤’•’£’∂’°’±’∏÷Ä">‘µ’≤’•’£’∂’°’±’∏÷Ä</option>
            <option value="‘≤’•÷Ä’§">‘≤’•÷Ä’§</option>
            <option value="’î’°’ª’°÷Ä’°’∂">’î’°’ª’°÷Ä’°’∂</option>
            <option value="’Ñ’°÷Ä’°’¨’´’Ø">’Ñ’°÷Ä’°’¨’´’Ø</option>
            <option value="’é’°’µ÷Ñ">’é’°’µ÷Ñ</option>
            <option value="‘±’∫’°÷Ä’°’∂">‘±’∫’°÷Ä’°’∂</option>
            <option value="’É’°’¥’¢’°÷Ä’°’Ø">’É’°’¥’¢’°÷Ä’°’Ø</option>
            <option value="’Ü’∏’µ’•’¥’¢’•÷Ä’µ’°’∂">’Ü’∏’µ’•’¥’¢’•÷Ä’µ’°’∂</option>
            <option value="‘π’°’¨’´’∂">‘π’°’¨’´’∂</option>
            <option value="’Ñ’•’≤÷Ä’´">’Ñ’•’≤÷Ä’´</option>
            <option value="‘±’£’°÷Ä’°’Ø">‘±’£’°÷Ä’°’Ø</option>
            <option value="’ã’•÷Ä’¥’∏÷Ç’Ø">’ã’•÷Ä’¥’∏÷Ç’Ø</option>
            <option value="‘¥÷Ä’°’¥’¢’∏’∂">‘¥÷Ä’°’¥’¢’∏’∂</option>
            <option value="‘±’≠’∏÷Ç÷Ä’µ’°’∂">‘±’≠’∏÷Ç÷Ä’µ’°’∂</option>
            <option value="‘¥’°’Ω’ø’°’Ø’•÷Ä’ø">‘¥’°’Ω’ø’°’Ø’•÷Ä’ø</option>
            <option value="’á’°’¥’¨’∏÷Ç’≤">’á’°’¥’¨’∏÷Ç’≤</option>
            <option value="’á’°’≤’°’ø">’á’°’≤’°’ø</option>
            <option value="’é’°’∞’°’∂">’é’°’∞’°’∂</option>
          </select>
          
          <button id="clear-filters-btn" onclick="clearFilters()" aria-label="’Ñ’°÷Ñ÷Ä’•’¨ ÷Ü’´’¨’ø÷Ä’•÷Ä’®">
            <img src="https://raw.githubusercontent.com/arammartirosyan1/Medical_Center_Map/main/icon/filter.png" alt="Clear Filters" />
          </button>
        </div>
      </div>
      
      <div id="centers-list"></div>
    </div>

    <div id="right-panel" class="expanded">
      <div id="map"></div>
      <!-- Move button container inside right panel -->
      <div id="open-button-container">
        <button id="open-list-btn">
          <img src="https://raw.githubusercontent.com/arammartirosyan1/Medical_Center_Map/main/icon/list.png" alt="Open List" id="list-icon">
          <span id="btn-text">‘≤’°÷Å’•’¨ ÷Å’°’∂’Ø’®</span>
        </button>
      </div>
    </div>
  </div>

  <div id="bottom-line"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    var map = L.map('map').setView([40.1792, 44.4991], 13);
    var panelState = 'closed'; // Initial state

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);

    let markers = [];
    let allCenters = [];
    let isMobile = window.innerWidth <= 768;

    // Setup toggle button
    const openListBtn = document.getElementById('open-list-btn');
    const leftPanel = document.getElementById('left-panel');
    const rightPanel = document.getElementById('right-panel');
    const btnText = document.getElementById('btn-text');
    const listIcon = document.getElementById('list-icon');

    openListBtn.addEventListener('click', togglePanel);

    function togglePanel() {
      if (panelState === 'open') {
        // Close the panel
        leftPanel.classList.add('collapsed');
        rightPanel.classList.add('expanded');
        btnText.textContent = '‘≤’°÷Å’•’¨ ÷Å’°’∂’Ø’®';
        panelState = 'closed';
      } else {
        // Open the panel
        leftPanel.classList.remove('collapsed');
        rightPanel.classList.remove('expanded');
        btnText.textContent = '’ì’°’Ø’•’¨ ÷Å’°’∂’Ø’®';
        panelState = 'open';
      }
      
      // Force map to update its size
      setTimeout(() => {
        map.invalidateSize();
      }, 300);
    }

    // Check window size and adjust layout
    function checkWindowSize() {
      isMobile = window.innerWidth <= 768;
      updateLayoutForScreenSize();
    }
    
    function updateLayoutForScreenSize() {
      // We keep the initial state as closed for both mobile and desktop
      // This can be changed if needed
    }

    // Run on page load
    checkWindowSize();
    
    // Update when window is resized
    window.addEventListener('resize', checkWindowSize);

    async function loadMedicalCenters() {
      try {
        const response = await fetch("/api/centers");
        allCenters = await response.json();
        displayMarkers(allCenters);
        displayCentersList(allCenters);
      } catch (error) {
        console.error("Error loading medical centers:", error);
        
        // For development testing without API
        // Use sample data or comment this out if API is available
        console.log("Using sample data for development");
        const sampleCenters = [
          {
            name: "’ß÷Ü’•’Ω ’°’∫’°’∞’∏’æ’°’£÷Ä’°’Ø’°’∂ ’®’∂’Ø’•÷Ä’∏÷Ç’©’µ’∏÷Ç’∂",
            categori: "‘±’∫’°’∞’∏’æ’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂",
            address: "‘µ÷Ä÷á’°’∂, ’é’°’¶’£’•’∂ ’ç’°÷Ä’£’Ω’µ’°’∂ 10, 110 ’Ω’•’∂’µ’°’Ø",
            phone_number: "+374 10 54 00 01",
            url: "https://www.efes.am",
            lat: 40.1792,
            lng: 44.5091
          },
          {
            name: "’é’°÷Ä’§’°’∂’°’∂÷Å ’∂’∏÷Ä’°÷Ä’°’Ø’°’∂ ’¢’™’∑’Ø’∏÷Ç’©’µ’°’∂ ’Ø’•’∂’ø÷Ä’∏’∂",
            categori: "‘≤’∏÷Ç’™‚Ä§ ‘ø’•’∂’ø÷Ä’∏’∂",
            address: "‘µ÷Ä÷á’°’∂, ’é’°÷Ä’§’°’∂’°’∂÷Å 18/1",
            phone_number: "+374 10 58 93 00",
            url: "https://vardanants.am",
            lat: 40.1842,
            lng: 44.5151
          },
          {
            name: "‘±’Ω’ø’≤’´’Ø ’¢’™’∑’Ø’°’Ø’°’∂ ’Ø’•’∂’ø÷Ä’∏’∂",
            categori: "‘≤’∏÷Ç’™‚Ä§ ‘ø’•’∂’ø÷Ä’∏’∂",
            address: "‘µ÷Ä÷á’°’∂, ‘¥’°’∂’´’•’¨ ’é’°÷Ä’∏÷Ç’™’°’∂ 28",
            phone_number: "+374 10 20 20 10",
            lat: 40.1902,
            lng: 44.4991
          }
        ];
        displayMarkers(sampleCenters);
        displayCentersList(sampleCenters);
        allCenters = sampleCenters;
      }
    }

    const customIcon = L.icon({
      iconUrl: 'https://raw.githubusercontent.com/arammartirosyan1/Medical_Center_Map/main/icon/hospital.png',
      iconSize: [45, 45],
      iconAnchor: [16, 32],
      popupAnchor: [0, -32]
    });

    const efesIcon = L.icon({
      iconUrl: 'https://static.wixstatic.com/media/1d13cb_e4e62ab7709c463b8b1d31d016cd096c~mv2.png/v1/fill/w_60,h_60,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/main%20umdrella%20sign.png',
      iconSize: [45, 45],
      iconAnchor: [16, 32],
      popupAnchor: [0, -32]
    });

    const vardanancIcon = L.icon({
      iconUrl: 'https://cdn-ru.bitrix24.ru/b15506840/resize_cache/333/f72cdc32ecc10461003d548dee4468d0/crm/button/8cb6cc9bd5f03a0f6a4e3fcde031bda5.png',
      iconSize: [45, 45],
      iconAnchor: [16, 32],
      popupAnchor: [0, -32]
    });

    function displayMarkers(centers) {
      markers.forEach(marker => map.removeLayer(marker));
      markers = [];

      centers.forEach(center => {
        let iconToUse = customIcon;
        if (center.name === "’ß÷Ü’•’Ω ’°’∫’°’∞’∏’æ’°’£÷Ä’°’Ø’°’∂ ’®’∂’Ø’•÷Ä’∏÷Ç’©’µ’∏÷Ç’∂") iconToUse = efesIcon;
        if (center.name === "’é’°÷Ä’§’°’∂’°’∂÷Å ’∂’∏÷Ä’°÷Ä’°’Ø’°’∂ ’¢’™’∑’Ø’∏÷Ç’©’µ’°’∂ ’Ø’•’∂’ø÷Ä’∏’∂") iconToUse = vardanancIcon;

        let marker = L.marker([center.lat, center.lng], { icon: iconToUse })
          .addTo(map)
          .bindPopup(`<b>${center.name}</b><br>${center.address}`);

        markers.push(marker);
        center.marker = marker;
      });
    }

    function displayCentersList(centers) {
      const listContainer = document.getElementById('centers-list');
      listContainer.innerHTML = '';

      centers.forEach(center => {
        const div = document.createElement('div');
        div.className = 'center-item';

        div.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <b class="text-font_size_title ">${center.name}</b>
                <p class="text-font_size">${center.categori}</p>
              </div>
              ${center.url ? `<a href="${center.url}" target="_blank" class="view-website-btn" style="text-decoration: none; background: none; border: none; color: inherit;">
                <img src="https://raw.githubusercontent.com/arammartirosyan1/Medical_Center_Map/main/icon/web.png" alt="View Website" style="width: 35px; height: 35px;">
              </a>` : ''}
            </div>
            <div>
            <p class="text-font_size">${center.address}</p>
            <p class="text-font_size"><a href="tel:${center.phone_number?.replace(/\s+/g, '')}">${center.phone_number || "No phone available"}</a></p>
            </div>
          `;

        div.onclick = () => {
          map.setView([center.lat, center.lng], 15);
          center.marker.openPopup();
          
          // On mobile, close the panel after selecting a center
          if (isMobile && panelState === 'open') {
            togglePanel();
          }
        };

        listContainer.appendChild(div);
      });
    }

    function filterMarkers() {
      const searchQuery = document.getElementById("search").value.toLowerCase();
      const selectedcategori = document.getElementById("categori-filter").value;
      const selectedcity = document.getElementById("city-filter").value;

      const filtered = allCenters.filter(center => {
        const matchesName = center.name.toLowerCase().includes(searchQuery);
        const matchescategori = !selectedcategori || (center.categori && center.categori === selectedcategori);
        const matchesCity = !selectedcity || (center.address && center.address.includes(selectedcity));
        return matchesName && matchescategori && matchesCity;
      });

      displayMarkers(filtered);
      displayCentersList(filtered);
    }

    function clearFilters() {
      document.getElementById("search").value = '';
      document.getElementById("categori-filter").value = '';
      document.getElementById("city-filter").value = '';
      filterMarkers();
    }

    loadMedicalCenters();
  </script>
</body>
</html>